import{r as D,a as g,j as T,F as fe,L as he,u as pe,d as ge,_ as me,e as we,f as ve,R as v,g as ke,S as be,h as I,T as C,t as Se,E as Te,s as ne,m as xe,W as _e,M as Ee,b as ye,c as Me}from"./assets/workbench-b198d476.js";const Ce=he;function Re({rootItem:i,render:e,icon:t,isError:s,selectedItem:o,onAccepted:r,onSelected:n,onHighlighted:l,treeState:a,setTreeState:f,noItemsMessage:c,dataTestId:h,autoExpandDeep:m}){const p=D.useMemo(()=>{for(let d=o==null?void 0:o.parent;d;d=d.parent)a.expandedItems.set(d.id,!0);return Ne(i,a.expandedItems,m)},[i,o,a,m]);return g(Ce,{items:[...p.keys()],id:d=>d.id,dataTestId:h,render:d=>{const w=e(d);return T(fe,{children:[t&&g("div",{className:"codicon "+(t(d)||"blank"),style:{minWidth:16,marginRight:4}}),typeof w=="string"?g("div",{style:{textOverflow:"ellipsis",overflow:"hidden"},children:w}):w]})},icon:d=>{const w=p.get(d).expanded;if(typeof w=="boolean")return w?"codicon-chevron-down":"codicon-chevron-right"},isError:d=>(s==null?void 0:s(d))||!1,indent:d=>p.get(d).depth,selectedItem:o,onAccepted:d=>r==null?void 0:r(d),onSelected:d=>n==null?void 0:n(d),onHighlighted:d=>l==null?void 0:l(d),onLeftArrow:d=>{const{expanded:w,parent:b}=p.get(d);w?(a.expandedItems.set(d.id,!1),f({...a})):b&&(n==null||n(b))},onRightArrow:d=>{d.children.length&&(a.expandedItems.set(d.id,!0),f({...a}))},onIconClicked:d=>{const{expanded:w}=p.get(d);if(w){for(let b=o;b;b=b.parent)if(b===d){n==null||n(d);break}a.expandedItems.set(d.id,!1)}else a.expandedItems.set(d.id,!0);f({...a})},noItemsMessage:c})}function Ne(i,e,t){const s=new Map,o=(r,n)=>{for(const l of r.children){const a=e.get(l.id),f=(t||n===0)&&s.size<25&&a!==!1,c=l.children.length?a||f:void 0;s.set(l,{depth:n,expanded:c,parent:i===r?null:r}),c&&o(l,n+1)}};return o(i,0),s}class Be{constructor(e){this._tests=new Map,this._rootSuite=new j("","root"),this._reporter=e}dispatch(e){const{method:t,params:s}=e;if(t==="onBegin"){this._onBegin(s.config,s.projects);return}if(t==="onTestBegin"){this._onTestBegin(s.testId,s.result);return}if(t==="onTestEnd"){this._onTestEnd(s.testId,s.result);return}if(t==="onStepBegin"){this._onStepBegin(s.testId,s.resultId,s.step);return}if(t==="onStepEnd"){this._onStepEnd(s.testId,s.resultId,s.step);return}if(t==="onError"){this._onError(s.error);return}if(t==="onStdIO"){this._onStdIO(s.type,s.testId,s.resultId,s.data,s.isBase64);return}if(t==="onEnd"){this._onEnd(s.result);return}}_onBegin(e,t){var s,o;for(const r of t){let n=this._rootSuite.suites.find(a=>a.project().id===r.id);n||(n=new j(r.name,"project"),this._rootSuite.suites.push(n),n.parent=this._rootSuite);const l=this._parseProject(r);if(n.project=()=>l,this._mergeSuitesInto(r.suites,n),e.listOnly){const a=new Set,f=h=>{h.tests.map(m=>m.testId).forEach(m=>a.add(m)),h.suites.forEach(f)};r.suites.forEach(f);const c=h=>{h.tests=h.tests.filter(m=>a.has(m.id)),h.suites.forEach(c)};c(n)}}(o=(s=this._reporter).onBegin)==null||o.call(s,this._parseConfig(e),this._rootSuite)}_onTestBegin(e,t){var r,n;const s=this._tests.get(e),o=s._createTestResult(t.id);o.retry=t.retry,o.workerIndex=t.workerIndex,o.parallelIndex=t.parallelIndex,o.startTime=new Date(t.startTime),o.statusEx="running",(n=(r=this._reporter).onTestBegin)==null||n.call(r,s,o)}_onTestEnd(e,t){var r,n;const s=this._tests.get(e),o=s.resultsMap.get(t.id);o.duration=t.duration,o.status=t.status,o.statusEx=t.status,o.errors=t.errors,o.attachments=t.attachments,(n=(r=this._reporter).onTestEnd)==null||n.call(r,s,o)}_onStepBegin(e,t,s){var l,a;const o=this._tests.get(e),r=o.resultsMap.get(t),n={titlePath:()=>[],title:s.title,category:s.category,location:s.location,startTime:new Date(s.startTime),duration:0,steps:[]};r.stepMap.set(s.id,n),r.stepStack[r.stepStack.length-1].steps.push(n),r.stepStack.push(n),(a=(l=this._reporter).onStepBegin)==null||a.call(l,o,r,n)}_onStepEnd(e,t,s){var a,f;const o=this._tests.get(e),r=o.resultsMap.get(t),n=r.stepMap.get(s.id),l=r.stepStack.indexOf(n);l!==-1&&r.stepStack.splice(l,1),n.duration=s.duration,n.error=s.error,(f=(a=this._reporter).onStepEnd)==null||f.call(a,o,r,n)}_onError(e){var t,s;(s=(t=this._reporter).onError)==null||s.call(t,e)}_onStdIO(e,t,s,o,r){var f,c,h,m;const n=r?Buffer.from(o,"base64"):o,l=t?this._tests.get(t):void 0,a=l&&s?l.resultsMap.get(s):void 0;e==="stdout"?(c=(f=this._reporter).onStdOut)==null||c.call(f,n,l,a):(m=(h=this._reporter).onStdErr)==null||m.call(h,n,l,a)}_onEnd(e){var t,s;(s=(t=this._reporter).onEnd)==null||s.call(t,e)}_parseConfig(e){const t=oe;return t.rootDir=e.rootDir,t.configFile=e.configFile,t}_parseProject(e){return{id:e.id,metadata:e.metadata,name:e.name,outputDir:e.outputDir,repeatEach:e.repeatEach,retries:e.retries,testDir:e.testDir,testIgnore:$(e.testIgnore),testMatch:$(e.testMatch),timeout:e.timeout,grep:$(e.grep),grepInvert:$(e.grepInvert),dependencies:e.dependencies,snapshotDir:e.snapshotDir,use:{}}}_mergeSuitesInto(e,t){for(const s of e){let o=t.suites.find(r=>r.title===s.title);o||(o=new j(s.title,s.type),o.parent=t,t.suites.push(o)),o.location=s.location,o._fileId=s.fileId,o._parallelMode=s.parallelMode,this._mergeSuitesInto(s.suites,o),this._mergeTestsInto(s.tests,o)}}_mergeTestsInto(e,t){for(const s of e){let o=t.tests.find(r=>r.title===s.title);o||(o=new Fe(s.testId,s.title,s.location),o.parent=t,t.tests.push(o),this._tests.set(o.id,o)),this._updateTest(s,o)}}_updateTest(e,t){return t.id=e.testId,t.expectedStatus=e.expectedStatus,t.timeout=e.timeout,t.location=e.location,t.annotations=e.annotations,t.retries=e.retries,t}}class j{constructor(e,t){this._requireFile="",this.suites=[],this.tests=[],this._parallelMode="default",this.title=e,this._type=t}allTests(){const e=[],t=s=>{for(const o of[...s.suites,...s.tests])o instanceof j?t(o):e.push(o)};return t(this),e}titlePath(){const e=this.parent?this.parent.titlePath():[];return(this.title||this._type!=="describe")&&e.push(this.title),e}project(){}}class Fe{constructor(e,t,s){this.fn=()=>{},this.results=[],this.expectedStatus="passed",this.timeout=0,this.annotations=[],this.retries=0,this.repeatEachIndex=0,this.resultsMap=new Map,this.id=e,this.title=t,this.location=s}titlePath(){const e=this.parent?this.parent.titlePath():[];return e.push(this.title),e}outcome(){const e=this.results.filter(t=>t.status!=="skipped"&&t.status!=="interrupted");return e.length?e.every(t=>t.status===this.expectedStatus)?"expected":e.some(t=>t.status===this.expectedStatus)?"flaky":"unexpected":"skipped"}ok(){const e=this.outcome();return e==="expected"||e==="flaky"||e==="skipped"}_clearResults(){this.results=[],this.resultsMap.clear()}_createTestResult(e){this._clearResults();const t={retry:this.results.length,parallelIndex:-1,workerIndex:-1,duration:-1,startTime:new Date,stdout:[],stderr:[],attachments:[],status:"skipped",statusEx:"scheduled",steps:[],errors:[],stepMap:new Map,stepStack:[]};return t.stepStack.push(t),this.results.push(t),this.resultsMap.set(e,t),t}}const oe={forbidOnly:!1,fullyParallel:!1,globalSetup:null,globalTeardown:null,globalTimeout:0,grep:/.*/,grepInvert:null,maxFailures:0,metadata:{},preserveOutput:"always",projects:[],reporter:[[{}.CI?"dot":"list"]],reportSlowTests:{max:5,threshold:15e3},configFile:"",rootDir:"",quiet:!1,shard:null,updateSnapshots:"missing",version:"",workers:0,webServer:null};function $(i){return i.map(e=>e.s?e.s:new RegExp(e.r.source,e.r.flags))}const De=({source:i})=>{const[e,t]=pe(),[s,o]=D.useState(ge()),[r]=D.useState(me(()=>import("./assets/xtermModule-0fb1e5c9.js"),["./assets/xtermModule-0fb1e5c9.js","./xtermModule.6428296b.css"],import.meta.url).then(l=>l.default)),n=D.useRef(null);return D.useEffect(()=>(we(o),()=>ve(o)),[]),D.useEffect(()=>{const l=i.write,a=i.clear;return(async()=>{const{Terminal:f,FitAddon:c}=await r,h=t.current;if(!h)return;const m=s==="dark-mode"?Le:Pe;if(n.current&&n.current.terminal.options.theme===m)return;n.current&&(h.textContent="");const p=new f({convertEol:!0,fontSize:13,scrollback:1e4,fontFamily:"var(--vscode-editor-font-family)",theme:m}),d=new c;p.loadAddon(d);for(const w of i.pending)p.write(w);i.write=w=>{i.pending.push(w),p.write(w)},i.clear=()=>{i.pending=[],p.clear()},p.open(h),d.fit(),n.current={terminal:p,fitAddon:d}})(),()=>{i.clear=a,i.write=l}},[r,n,t,i,s]),D.useEffect(()=>{setTimeout(()=>{n.current&&(n.current.fitAddon.fit(),i.resize(n.current.terminal.cols,n.current.terminal.rows))},250)},[e,i]),g("div",{"data-testid":"output",className:"xterm-wrapper",style:{flex:"auto"},ref:t})},Pe={foreground:"#383a42",background:"#fafafa",cursor:"#383a42",black:"#000000",red:"#e45649",green:"#50a14f",yellow:"#c18401",blue:"#4078f2",magenta:"#a626a4",cyan:"#0184bc",white:"#a0a0a0",brightBlack:"#000000",brightRed:"#e06c75",brightGreen:"#98c379",brightYellow:"#d19a66",brightBlue:"#4078f2",brightMagenta:"#a626a4",brightCyan:"#0184bc",brightWhite:"#383a42",selectionBackground:"#d7d7d7",selectionForeground:"#383a42"},Le={foreground:"#f8f8f2",background:"#1e1e1e",cursor:"#f8f8f0",black:"#000000",red:"#ff5555",green:"#50fa7b",yellow:"#f1fa8c",blue:"#bd93f9",magenta:"#ff79c6",cyan:"#8be9fd",white:"#bfbfbf",brightBlack:"#4d4d4d",brightRed:"#ff6e6e",brightGreen:"#69ff94",brightYellow:"#ffffa5",brightBlue:"#d6acff",brightMagenta:"#ff92df",brightCyan:"#a4ffff",brightWhite:"#e6e6e6",selectionBackground:"#44475a",selectionForeground:"#f8f8f2"};function Oe(i){return`.playwright-artifacts-${i}`}let G=()=>{},re=i=>{},ae={cols:80,rows:24};const P={pending:[],clear:()=>{},write:i=>P.pending.push(i),resize:(i,e)=>{ae={cols:i,rows:e},A("resizeTerminal",{cols:i,rows:e})}},We=({})=>{var ee;const[i,e]=v.useState(""),[t,s]=v.useState(!1),[o,r]=v.useState(new Map([["passed",!1],["failed",!1],["skipped",!1]])),[n,l]=v.useState(new Map),[a,f]=v.useState({config:void 0,rootSuite:void 0}),[c,h]=v.useState(),[m,p]=v.useState({}),[d,w]=v.useState(new Set),[b,M]=v.useState(!1),[y,L]=v.useState(),[O,u]=ke("watch-all",!1),[E,k]=v.useState({value:new Set}),x=v.useRef(Promise.resolve()),S=v.useRef(new Set),_=v.useRef(null),K=()=>{M(!0),k({value:new Set}),G(oe,new j("","root"),void 0),le(!0).then(()=>{M(!1)})};v.useEffect(()=>{var B;(B=_.current)==null||B.focus(),K()},[]),G=(B,z,R)=>{const F=B.configFile?ne.getObject(B.configFile+":projects",void 0):void 0;for(const N of n.keys())z.suites.find(U=>U.title===N)||n.delete(N);for(const N of z.suites)n.has(N.title)||n.set(N.title,!!(F!=null&&F.includes(N.title)));!F&&n.size&&![...n.values()].includes(!0)&&n.set(n.entries().next().value[0],!0),f({config:B,rootSuite:z}),l(new Map(n)),y&&R?h({...R,total:y.testIds.size}):R||h(void 0)};const Q=v.useCallback((B,z)=>{B==="bounce-if-busy"&&y||(S.current=new Set([...S.current,...z]),x.current=x.current.then(async()=>{var N,U,te;const R=S.current;if(S.current=new Set,!R.size)return;{for(const V of((N=a.rootSuite)==null?void 0:N.allTests())||[])R.has(V.id)&&V._createTestResult("pending");f({...a})}const F="  ["+new Date().toLocaleTimeString()+"]";P.write("\x1B[2m—".repeat(Math.max(0,ae.cols-F.length))+F+"\x1B[22m"),h({total:R.size,passed:0,failed:0,skipped:0}),L({testIds:R}),await J("run",{testIds:[...R]});for(const V of((U=a.rootSuite)==null?void 0:U.allTests())||[])((te=V.results[0])==null?void 0:te.duration)===-1&&V._clearResults();f({...a}),L(void 0)}))},[y,a]),W=!!y;return g("div",{className:"vbox watch-mode",children:T(be,{sidebarSize:250,orientation:"horizontal",sidebarIsFirst:!0,children:[T("div",{className:"vbox",children:[T("div",{className:"vbox"+(t?"":" hidden"),children:[T(I,{children:[g("div",{className:"section-title",style:{flex:"none"},children:"Output"}),g(C,{icon:"circle-slash",title:"Clear output",onClick:()=>P.clear()}),g("div",{className:"spacer"}),g(C,{icon:"close",title:"Close",onClick:()=>s(!1)})]}),g(De,{source:P})]}),g("div",{className:"vbox"+(t?" hidden":""),children:g(Ae,{item:m,rootDir:(ee=a.config)==null?void 0:ee.rootDir})})]}),T("div",{className:"vbox watch-mode-sidebar",children:[T(I,{noShadow:!0,noMinHeight:!0,children:[g("img",{src:"icon-32x32.png"}),g("div",{className:"section-title",children:"Playwright"}),g(C,{icon:"color-mode",title:"Toggle color mode",onClick:()=>Se()}),g(C,{icon:"refresh",title:"Reload",onClick:()=>K(),disabled:W||b}),g(C,{icon:"terminal",title:"Toggle output",toggled:t,onClick:()=>{s(!t)}})]}),g(je,{filterText:i,setFilterText:e,statusFilters:o,setStatusFilters:r,projectFilters:n,setProjectFilters:l,testModel:a,runTests:()=>Q("bounce-if-busy",d)}),T(I,{noMinHeight:!0,children:[!W&&!c&&g("div",{className:"section-title",children:"Tests"}),!W&&c&&g("div",{"data-testid":"status-line",className:"status-line",children:T("div",{children:[c.passed,"/",c.total," passed (",c.passed/c.total*100|0,"%)"]})}),W&&c&&g("div",{"data-testid":"status-line",className:"status-line",children:T("div",{children:["Running ",c.passed,"/",y.testIds.size," passed (",c.passed/y.testIds.size*100|0,"%)"]})}),g(C,{icon:"play",title:"Run all",onClick:()=>Q("bounce-if-busy",d),disabled:W||b}),g(C,{icon:"debug-stop",title:"Stop",onClick:()=>A("stop"),disabled:!W||b}),g(C,{icon:"eye",title:"Watch all",toggled:O,onClick:()=>u(!O)})]}),g(Ve,{statusFilters:o,projectFilters:n,filterText:i,testModel:a,runningState:y,runTests:Q,onItemSelected:p,setVisibleTestIds:w,watchAll:O,watchedTreeIds:E,setWatchedTreeIds:k,isLoading:b})]})]})})},je=({filterText:i,setFilterText:e,statusFilters:t,setStatusFilters:s,projectFilters:o,setProjectFilters:r,testModel:n,runTests:l})=>{const[a,f]=v.useState(!1),c=v.useRef(null);v.useEffect(()=>{var p;(p=c.current)==null||p.focus()},[]);const h=[...t.entries()].filter(([p,d])=>d).map(([p])=>p).join(" ")||"all",m=[...o.entries()].filter(([p,d])=>d).map(([p])=>p).join(" ")||"all";return T("div",{className:"filters",children:[g(Te,{expanded:a,setExpanded:f,title:g("input",{ref:c,type:"search",placeholder:"Filter (e.g. text, @tag)",spellCheck:!1,value:i,onChange:p=>{e(p.target.value)},onKeyDown:p=>{p.key==="Enter"&&l()}})}),T("div",{className:"filter-summary",title:"Status: "+h+`
Projects: `+m,onClick:()=>f(!a),children:[g("span",{className:"filter-label",children:"Status:"})," ",h,g("span",{className:"filter-label",children:"Projects:"})," ",m]}),a&&T("div",{className:"hbox",style:{marginLeft:14},children:[g("div",{className:"filter-list",children:[...t.entries()].map(([p,d])=>g("div",{className:"filter-entry",children:T("label",{children:[g("input",{type:"checkbox",checked:d,onClick:()=>{const w=new Map(t);w.set(p,!w.get(p)),s(w)}}),g("div",{children:p})]})}))}),g("div",{className:"filter-list",children:[...o.entries()].map(([p,d])=>g("div",{className:"filter-entry",children:T("label",{children:[g("input",{type:"checkbox",checked:d,onClick:()=>{var M;const w=new Map(o);w.set(p,!w.get(p)),r(w);const b=(M=n==null?void 0:n.config)==null?void 0:M.configFile;b&&ne.setObject(b+":projects",[...w.entries()].filter(([y,L])=>L).map(([y])=>y))}}),g("div",{children:p})]})}))})]})]})},ze=Re,Ve=({statusFilters:i,projectFilters:e,filterText:t,testModel:s,runTests:o,runningState:r,watchAll:n,watchedTreeIds:l,setWatchedTreeIds:a,isLoading:f,onItemSelected:c,setVisibleTestIds:h})=>{const[m,p]=v.useState({expandedItems:new Map}),[d,w]=v.useState(),{rootItem:b,treeItemMap:M,fileNames:y}=v.useMemo(()=>{let u=$e(s.rootSuite,e);qe(u,t,i,r==null?void 0:r.testIds),de(u),u=Ie(u),Ye(u);const E=new Map,k=new Set,x=new Set,S=_=>{_.kind==="group"&&_.location.file&&x.add(_.location.file),_.kind==="case"&&_.tests.forEach(K=>k.add(K.id)),_.children.forEach(S),E.set(_.id,_)};return S(u),h(k),{rootItem:u,treeItemMap:E,fileNames:x}},[t,s,i,e,h,r]);v.useEffect(()=>{if(!r||r.itemSelectedByUser)return;let u;const E=k=>{var x;k.children.forEach(E),!u&&k.status==="failed"&&(k.kind==="test"&&r.testIds.has(k.test.id)||k.kind==="case"&&r.testIds.has((x=k.tests[0])==null?void 0:x.id))&&(u=k)};E(b),u&&w(u.id)},[r,w,b]);const{selectedTreeItem:L}=v.useMemo(()=>{const u=d?M.get(d):void 0,E=u==null?void 0:u.location;let k;return(u==null?void 0:u.kind)==="test"?k=u.test:(u==null?void 0:u.kind)==="case"&&u.tests.length===1&&(k=u.tests[0]),c({testCase:k,location:E}),{selectedTreeItem:u}},[c,d,M]);v.useEffect(()=>{if(n)A("watch",{fileNames:[...y]});else{const u=new Set;for(const E of l.value){const k=M.get(E),x=k==null?void 0:k.location.file;x&&u.add(x)}A("watch",{fileNames:[...u]})}},[b,y,n,l,M]);const O=u=>{w(u.id),o("bounce-if-busy",Z(u))};return re=u=>{const E=[],k=new Set(u);if(n){const x=S=>{const _=S.location.file;_&&k.has(_)&&E.push(...Z(S)),S.kind==="group"&&S.subKind==="folder"&&S.children.forEach(x)};x(b)}else for(const x of l.value){const S=M.get(x),_=S==null?void 0:S.location.file;_&&k.has(_)&&E.push(...Z(S))}o("queue-if-busy",new Set(E))},g(ze,{treeState:m,setTreeState:p,rootItem:b,dataTestId:"test-tree",render:u=>T("div",{className:"hbox watch-mode-list-item",children:[g("div",{className:"watch-mode-list-item-title",children:u.title}),!!u.duration&&u.status!=="skipped"&&g("div",{className:"watch-mode-list-item-time",children:xe(u.duration)}),T(I,{noMinHeight:!0,noShadow:!0,children:[g(C,{icon:"play",title:"Run",onClick:()=>O(u),disabled:!!r}),g(C,{icon:"go-to-file",title:"Open in VS Code",onClick:()=>A("open",{location:Ue(u)})}),!n&&g(C,{icon:"eye",title:"Watch",onClick:()=>{l.value.has(u.id)?l.value.delete(u.id):l.value.add(u.id),a({...l})},toggled:l.value.has(u.id)})]})]}),icon:u=>u.status==="scheduled"?"codicon-clock":u.status==="running"?"codicon-loading":u.status==="failed"?"codicon-error":u.status==="passed"?"codicon-check":u.status==="skipped"?"codicon-circle-slash":"codicon-circle-outline",selectedItem:L,onAccepted:O,onSelected:u=>{r&&(r.itemSelectedByUser=!0),w(u.id)},autoExpandDeep:!!t,noItemsMessage:f?"Loading…":"No tests"})},Ae=({item:i,rootDir:e})=>{const[t,s]=v.useState(),[o,r]=v.useState(0),n=v.useRef(null),{outputDir:l,result:a}=v.useMemo(()=>{var h;const f=i.testCase?Ke(i.testCase):void 0,c=(h=i.testCase)==null?void 0:h.results[0];return{outputDir:f,result:c}},[i]);return v.useEffect(()=>{var h;if(n.current&&clearTimeout(n.current),!a){s(void 0);return}const f=a&&a.duration>=0&&a.attachments.find(m=>m.name==="trace");if(f&&f.path){ie(f.path).then(m=>s(m));return}if(!l){s(void 0);return}const c=`${l}/${Oe(a.workerIndex)}/traces/${(h=i.testCase)==null?void 0:h.id}.json`;return n.current=setTimeout(async()=>{try{const m=await ie(c);s(m)}catch{s(void 0)}finally{r(o+1)}},250),()=>{n.current&&clearTimeout(n.current)}},[a,l,i,s,o,r]),g(_e,{model:t,hideTimelineBars:!0,hideStackFrames:!0,showSourcesFirst:!0,rootDir:e,defaultSourceLocation:i.location},"workbench")};let Y,H,X;const se=()=>{clearTimeout(H),H=void 0,G(X.config,X.rootSuite,X.progress)},q=(i,e,t,s=!1)=>{X={config:i,rootSuite:e,progress:t},s?se():H||(H=setTimeout(se,250))},le=i=>{if(!i)return J("list",{});let e;const t={passed:0,failed:0,skipped:0};let s;return Y=new Be({onBegin:(o,r)=>{e||(e=r),s=o,t.passed=0,t.failed=0,t.skipped=0,q(s,e,t,!0)},onEnd:()=>{q(s,e,t,!0)},onTestBegin:()=>{q(s,e,t)},onTestEnd:o=>{o.outcome()==="skipped"?++t.skipped:o.outcome()==="unexpected"?++t.failed:++t.passed,q(s,e,t)},onError:o=>{P.write((o.stack||o.value||"")+`
`)}}),J("list",{})};window.dispatch=i=>{if(i.method==="listChanged"){le(!1).catch(()=>{});return}if(i.method==="testFilesChanged"){re(i.params.testFileNames);return}if(i.method==="stdio"){if(i.params.buffer){const e=atob(i.params.buffer);P.write(e)}else P.write(i.params.text);return}Y==null||Y.dispatch(i)};const J=async(i,e)=>{await window.sendMessage({method:i,params:e})},A=(i,e)=>{if(window._overrideProtocolForTest){window._overrideProtocolForTest({method:i,params:e}).catch(()=>{});return}J(i,e).catch(t=>{console.error(t)})},Ke=i=>{var e;for(let t=i.parent;t;t=t.parent)if(t.project())return(e=t.project())==null?void 0:e.outputDir},Ue=i=>{if(i)return i.location.file+":"+i.location.line},Z=i=>{const e=new Set;if(!i)return e;const t=s=>{var o;s.kind==="case"?s.tests.map(r=>r.id).forEach(r=>e.add(r)):s.kind==="test"?e.add(s.id):(o=s.children)==null||o.forEach(t)};return t(i),e};function ce(i,e,t,s){if(e.length===0)return i;const o=e.join(ue),r=s.get(o);if(r)return r;const n=ce(i,e.slice(0,e.length-1),!1,s),l={kind:"group",subKind:t?"file":"folder",id:o,title:e[e.length-1],location:{file:o,line:0,column:0},duration:0,parent:n,children:[],status:"none"};return n.children.push(l),s.set(o,l),l}function $e(i,e){const t=[...e.values()].some(Boolean),s={kind:"group",subKind:"folder",id:"root",title:"",location:{file:"",line:0,column:0},duration:0,parent:void 0,children:[],status:"none"},o=(n,l,a)=>{for(const f of l.suites){const c=f.title||"<anonymous>";let h=a.children.find(m=>m.title===c);h||(h={kind:"group",subKind:"describe",id:a.id+""+c,title:c,location:f.location,duration:0,parent:a,children:[],status:"none"},a.children.push(h)),o(n,f,h)}for(const f of l.tests){const c=f.title;let h=a.children.find(d=>d.title===c);h||(h={kind:"case",id:a.id+""+c,title:c,parent:a,children:[],tests:[],location:f.location,duration:0,status:"none"},a.children.push(h));const m=f.results[0];let p="none";(m==null?void 0:m.statusEx)==="scheduled"?p="scheduled":(m==null?void 0:m.statusEx)==="running"?p="running":(m==null?void 0:m.status)==="skipped"?p="skipped":(m==null?void 0:m.status)==="interrupted"?p="none":m&&f.outcome()!=="expected"?p="failed":m&&f.outcome()==="expected"&&(p="passed"),h.tests.push(f),h.children.push({kind:"test",id:f.id,title:n,location:f.location,test:f,parent:h,children:[],status:p,duration:f.results.length?Math.max(0,f.results[0].duration):0,project:n}),h.duration=h.children.reduce((d,w)=>d+w.duration,0)}},r=new Map;for(const n of(i==null?void 0:i.suites)||[])if(!(t&&!e.get(n.title)))for(const l of n.suites){const a=ce(s,l.location.file.split(ue),!0,r);o(n.title,l,a)}return s}function qe(i,e,t,s){const o=e.trim().toLowerCase().split(" "),r=[...t.values()].some(Boolean),n=a=>{const f=a.tests[0].titlePath().join(" ").toLowerCase();return!o.every(c=>f.includes(c))&&!a.tests.some(c=>s==null?void 0:s.has(c.id))?!1:(a.children=a.children.filter(c=>!r||(s==null?void 0:s.has(c.id))||t.get(c.status)),a.tests=a.children.map(c=>c.test),!!a.children.length)},l=a=>{const f=[];for(const c of a.children)c.kind==="case"?n(c)&&f.push(c):(l(c),c.children.length&&f.push(c));a.children=f};l(i)}function de(i){for(const n of i.children)de(n);i.kind==="group"&&i.children.sort((n,l)=>n.location.file.localeCompare(l.location.file)||n.location.line-l.location.line);let e=i.children.length>0,t=i.children.length>0,s=!1,o=!1,r=!1;for(const n of i.children)t=t&&n.status==="skipped",e=e&&(n.status==="passed"||n.status==="skipped"),s=s||n.status==="failed",o=o||n.status==="running",r=r||n.status==="scheduled";o?i.status="running":r?i.status="scheduled":s?i.status="failed":t?i.status="skipped":e&&(i.status="passed")}function Ie(i){let e=i;for(;e.children.length===1&&e.children[0].kind==="group"&&e.children[0].subKind==="folder";)e=e.children[0];return e.location=i.location,e}function Ye(i){const e=t=>{t.kind==="case"&&t.children.length===1?t.children=[]:t.children.forEach(e)};e(i)}async function ie(i){const e=new URLSearchParams;e.set("trace",i);const s=await(await fetch(`contexts?${e.toString()}`)).json();return new Ee(s)}const ue=navigator.userAgent.toLowerCase().includes("windows")?"\\":"/";(async()=>(ye(),window.location.protocol!=="file:"&&(window.location.href.includes("isUnderTest=true")&&await new Promise(i=>setTimeout(i,1e3)),navigator.serviceWorker.register("sw.bundle.js"),navigator.serviceWorker.controller||await new Promise(i=>{navigator.serviceWorker.oncontrollerchange=()=>i()}),setInterval(function(){fetch("ping")},1e4)),Me.render(g(We,{}),document.querySelector("#root"))))();
