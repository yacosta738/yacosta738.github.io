---
import HighlightsList from "@/components/molecules/HighlightsList.astro";
import ProjectImage from "@/components/molecules/ProjectImage.astro";
/**
 * FeaturedProjectCard organism component.
 * This component renders a featured project card with alternating layout.
 * It closely follows the original React component's structure and styling.
 *
 * @prop {EnhancedProject} project - The enhanced project object containing all details.
 * @prop {boolean} isOdd - Determines the layout orientation (text on right if odd).
 * @prop {Lang} lang - The current language for translations.
 */
import ProjectLinks from "@/components/molecules/ProjectLinks.astro";
import ProjectTechList from "@/components/molecules/ProjectTechList.astro";
import type { EnhancedProject } from "@/core/resume/project/project.service";
import { type Lang, tr, useTranslations } from "@/i18n";
import { findImage } from "@/utils/images";
import Link from "../atoms/Link.astro";

interface Props {
	project: EnhancedProject;
	isOdd: boolean;
	lang: Lang;
	isFirst?: boolean;
}

const { project, isOdd, lang, isFirst = false } = Astro.props as Props;
const t = useTranslations(lang);

const coverImage = (await findImage(
	project.metadata?.cover || "~/assets/images/placeholder-1280x720.avif",
)) as ImageMetadata;

const translated = (
	key: string,
	params: Record<string, unknown> = {},
	fallback = "",
) => {
	return tr(t, key, params, fallback);
};

const projectUrl =
	project.metadata?.url ||
	project.url ||
	project.metadata?.repository ||
	project.github;
---

<li class={`featured-project ${isOdd ? 'odd' : ''}`}>
  <div class="project-content">
    <div>
      <p class="project-overline">
        {translated('featuredProject', {}, 'Featured Project')}
      </p>

      <h3 class="project-title">
        <Link
          href={projectUrl}
          target="_blank"
          rel="noopener noreferrer"
          title={`${translated('viewProject', {}, 'View project')}: ${project.name}`}
        >
          {project.name}
        </Link>
      </h3>

      <div class="project-description">
        <p>{project.description}</p>
        <HighlightsList highlights={project.highlights || []} columns={2} class="w-1/2" />
      </div>

      <ProjectTechList
        technologies={project.metadata?.tech || []}
        isOdd={isOdd}
      />

      <ProjectLinks
        projectName={project.name}
        github={project.metadata?.repository || project.github}
        external={project.metadata?.url || undefined}
        cta={undefined}
        isOdd={isOdd}
        lang={lang}
      />
    </div>
  </div>

  <div class="project-image">
    <ProjectImage
      image={coverImage}
      name={project.name}
      url={projectUrl}
      lang={lang}
      loading="lazy"
      fetchpriority={isFirst ? "high" : "auto"}
    />
  </div>
</li>

<style>
  /* Featured Project Item */
  .featured-project {
    position: relative;
    display: grid;
    grid-gap: 10px;
    grid-template-columns: repeat(12, 1fr);
    align-items: center;
    margin-bottom: 100px;
    transition: all 0.25s cubic-bezier(0.645, 0.045, 0.355, 1);
  }

  .featured-project:last-of-type {
    margin-bottom: 0;
  }

  .featured-project:hover,
  .featured-project:focus-within {
    transform: translateY(-7px);
  }

  @media (max-width: 768px) {
    .featured-project {
      margin-bottom: 70px;
      box-shadow:
        0 10px 30px -15px rgba(2, 12, 27, 0.7),
        0 4px 6px -2px rgba(2, 12, 27, 0.1);
    }
  }

  @media (max-width: 480px) {
    .featured-project {
      margin-bottom: 30px;
    }
  }

  /* Project Content */
  .project-content {
    position: relative;
    grid-column: 1 / 7;
    grid-row: 1 / -1;
  }

  @media (max-width: 1080px) {
    .project-content {
      grid-column: 1 / 9;
    }
  }

  @media (max-width: 768px) {
    .project-content {
      display: flex;
      flex-direction: column;
      justify-content: center;
      height: 100%;
      grid-column: 1 / -1;
      padding: 40px 40px 30px;
      z-index: 5;
    }
  }

  @media (max-width: 480px) {
    .project-content {
      padding: 30px 25px 20px;
    }
  }

  /* Project Image */
  .project-image {
    grid-column: 6 / -1;
    grid-row: 1 / -1;
    position: relative;
    z-index: 1;
  }

  @media (max-width: 768px) {
    .project-image {
      grid-column: 1 / -1;
      height: 100%;
    }
  }

  /* Odd Project Layout */
  .featured-project.odd .project-content {
    grid-column: 7 / -1;
    text-align: right;
  }

  @media (max-width: 1080px) {
    .featured-project.odd .project-content {
      grid-column: 5 / -1;
    }
  }

  @media (max-width: 768px) {
    .featured-project.odd .project-content {
      grid-column: 1 / -1;
      padding: 40px 40px 30px;
      text-align: left;
    }
  }

  @media (max-width: 480px) {
    .featured-project.odd .project-content {
      padding: 25px 25px 20px;
    }
  }

  /* Odd Project Image */
  .featured-project.odd .project-image {
    grid-column: 1 / 8;
  }

  @media (max-width: 768px) {
    .featured-project.odd .project-image {
      grid-column: 1 / -1;
    }
  }

  /* Project Overline */
  .project-overline {
    margin: 10px 0;
    color: var(--color-brand-accent);
    font-family: var(--font-mono);
    font-size: 0.813rem;
    font-weight: 400;
  }

  /* Project Title */
  .project-title {
    color: var(--color-foreground);
    font-size: clamp(24px, 5vw, 28px);
    margin: 0 0 20px;
  }

  @media (max-width: 768px) {
    .project-title {
      color: var(--color-foreground);
      font-weight: 600;
      margin: 0 0 20px;
    }

    .project-title a {
      position: static;
    }

    .project-title a:before {
      content: '';
      display: block;
      position: absolute;
      z-index: 0;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
    }
  }

  .project-title a {
    color: inherit;
    text-decoration: none;
    transition: color 0.25s cubic-bezier(0.645, 0.045, 0.355, 1);
  }

  .project-title a:hover,
  .project-title a:focus {
    color: var(--color-brand-accent);
  }

  /* Project Description */
  .project-description {
    position: relative;
    z-index: 2;
    padding: 25px;
    border-radius: 4px;
    background-color: var(--color-background-secondary);
    color: var(--color-foreground);
    font-size: 1.125rem;
    line-height: 1.6;
    box-shadow:
      0 10px 30px -15px rgba(2, 12, 27, 0.25),
      0 4px 6px -2px rgba(2, 12, 27, 0.05);
  }

  .project-description p {
    margin: 0 0 1rem 0;
  }

  .project-description p:last-child {
    margin-bottom: 0;
  }

  @media (max-width: 768px) {
    .project-description {
      padding: 20px 0;
      background-color: transparent;
      box-shadow: none;
    }
  }

  /* Odd Project Description Alignment */
  .featured-project.odd .project-description {
    margin-left: auto;
    margin-right: 0;
    max-width: 560px;
  }

  /* Dark mode adjustments */
  .dark .featured-project {
    box-shadow:
      0 10px 30px -15px rgba(2, 12, 27, 0.9),
      0 4px 6px -2px rgba(2, 12, 27, 0.3);
  }

  .dark .project-description {
    color: var(--color-foreground-muted);
    box-shadow:
      0 10px 30px -15px rgba(2, 12, 27, 0.9),
      0 4px 6px -2px rgba(2, 12, 27, 0.3);
  }
</style>
